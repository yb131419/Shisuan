<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>å“é …å ±è¡¨åŒ¯å‡º</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  /* åŸºæœ¬æ·±è‰²èƒŒæ™¯èˆ‡å­—é«” */
  body {
    background-color: #121212;
    color: #fff;
    font-family: 'Noto Sans TC', 'Arial', sans-serif;
    margin: 0;
    padding: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    user-select: none;
  }
  /* è¼¸å…¥å€å®¹å™¨ */
  #inputArea {
    max-width: 480px;
    margin: 0 auto 24px;
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 0 8px;
  }

  /* å“é …è¼¸å…¥æ¬„ (Combobox) */
  #nameInput, #qtyInput, #addBtn {
    font-size: 1.3rem;
    border-radius: 10px;
    border: none;
    outline-offset: 2px;
    transition: box-shadow 0.2s ease;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  #nameInput {
    flex: 1 1 60%;
    padding: 14px 16px;
    background-color: #222;
    color: #fff;
    cursor: text;
    -webkit-user-select: text;
    user-select: text;
  }
  #nameInput:focus {
    box-shadow: 0 0 8px 3px #42a5f5;
    background-color: #333;
  }

  /* ä¸‹æ‹‰æ¸…å–® */
  #autocomplete-list {
    position: absolute;
    top: 54px;
    left: 8px;
    right: calc(40% + 20px);
    max-height: 220px;
    overflow-y: auto;
    background: #222;
    border-radius: 0 0 10px 10px;
    border: 1px solid #555;
    z-index: 1000;
    display: none;
    user-select: none;
    -webkit-overflow-scrolling: touch;
  }
  #autocomplete-list div {
    padding: 14px 18px;
    cursor: pointer;
    color: #eee;
    font-size: 1.1rem;
    touch-action: manipulation;
  }
  #autocomplete-list div:hover, #autocomplete-list div.autocomplete-active {
    background-color: #444;
  }

  /* æ•¸é‡ä¸‹æ‹‰é¸å–® */
  #qtyInput {
    flex: 1 1 20%;
    padding: 14px 16px;
    background-color: #222;
    color: #fff;
    cursor: pointer;
  }
  #qtyInput:focus {
    box-shadow: 0 0 8px 3px #42a5f5;
    background-color: #333;
  }

  /* æ–°å¢æŒ‰éˆ• */
  #addBtn {
    flex: 1 1 18%;
    padding: 14px 0;
    background-color: #4caf50;
    color: white;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 6px 12px rgb(76 175 80 / 0.6);
    transition: background-color 0.3s ease;
    touch-action: manipulation;
    border-radius: 10px;
  }
  #addBtn:hover, #addBtn:focus {
    background-color: #45a049;
    outline: none;
  }
  #addBtn:active {
    background-color: #3b8e3a;
  }

  /* å ±è¡¨å€ */
  #captureArea {
    background: #222;
    color: #fff;
    padding: 24px 16px;
    border-radius: 14px;
    max-width: 480px;
    margin: 0 auto 24px;
    box-shadow: 0 0 24px rgba(0,0,0,0.8);
    user-select: text;
  }
  #captureArea h2 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 1.2px;
    user-select: none;
  }

  /* å ±è¡¨è¡¨æ ¼ */
  #reportTable {
    width: 100%;
    border-collapse: collapse;
    font-size: 1.1rem;
    table-layout: fixed;
    word-break: break-word;
  }
  #reportTable th, #reportTable td {
    border: 1px solid #555;
    padding: 12px 8px;
    text-align: center;
  }
  #reportTable thead {
    background: linear-gradient(90deg, #1e88e5, #42a5f5);
    color: #fff;
    font-weight: 700;
    letter-spacing: 0.1em;
  }
  #reportTable tfoot td {
    font-weight: 700;
    background-color: #111;
    color: #ccc;
    font-size: 1.15rem;
  }

  /* åˆªé™¤æŒ‰éˆ• */
  .deleteBtn {
    background-color: #e53935;
    border: none;
    color: white;
    border-radius: 10px;
    padding: 8px 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    font-size: 1rem;
    user-select: none;
    touch-action: manipulation;
  }
  .deleteBtn:hover, .deleteBtn:focus {
    background-color: #c62828;
    outline: none;
  }
  .deleteBtn:active {
    background-color: #9b1f1f;
  }

  /* åŒ¯å‡ºæŒ‰éˆ• */
  #exportBtn {
    margin: 0 auto;
    display: block;
    padding: 18px 32px;
    font-size: 1.3rem;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    letter-spacing: 0.04em;
    box-shadow: 0 8px 16px rgb(76 175 80 / 0.7);
    user-select: none;
    max-width: 480px;
    touch-action: manipulation;
  }
  #exportBtn:hover, #exportBtn:focus {
    background: #45a049;
    outline: none;
  }
  #exportBtn:active {
    background: #3b8e3a;
  }

  /* æ‰‹æ©Ÿç‰ˆå¾®èª¿ */
  @media (max-width: 480px) {
    #inputArea {
      padding: 0 12px;
      gap: 14px;
    }
    #nameInput, #qtyInput, #addBtn {
      font-size: 1.4rem;
      padding: 16px 20px;
      border-radius: 12px;
    }
    #exportBtn {
      font-size: 1.4rem;
      padding: 20px 36px;
    }
    #autocomplete-list {
      right: calc(40% + 24px);
      max-height: 240px;
    }
  }
</style>
</head>
<body>

  <div id="inputArea" role="combobox" aria-haspopup="listbox" aria-owns="autocomplete-list" aria-expanded="false">
    <input id="nameInput" type="text" placeholder="å“é …åç¨± (è¼¸å…¥æˆ–é¸æ“‡)" aria-autocomplete="list" aria-controls="autocomplete-list" autocomplete="off" aria-label="å“é …åç¨±" />
    <select id="qtyInput" aria-label="æ•¸é‡"></select>
    <button id="addBtn" aria-label="æ–°å¢å“é …">æ–°å¢å“é …</button>
    <div id="autocomplete-list" role="listbox" tabindex="-1"></div>
  </div>

  <div id="captureArea" aria-live="polite" aria-atomic="true" aria-relevant="all">
    <h2>ğŸ§¾ å“é …å ±è¡¨</h2>
    <table id="reportTable" aria-label="å“é …å ±è¡¨">
      <thead>
        <tr>
          <th scope="col">å“é …åç¨±</th>
          <th scope="col">æ•¸é‡</th>
          <th scope="col">å–®åƒ¹</th>
          <th scope="col">PV</th>
          <th scope="col">å°è¨ˆåƒ¹æ ¼</th>
          <th scope="col">å°è¨ˆPV</th>
          <th scope="col">åˆªé™¤</th>
        </tr>
      </thead>
      <tbody id="reportBody"></tbody>
      <tfoot>
        <tr>
          <td>ç¸½è¨ˆ</td>
          <td id="totalQty">0</td>
          <td></td>
          <td></td>
          <td id="totalPrice">0</td>
          <td id="totalPv">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <button id="exportBtn" aria-label="åŒ¯å‡ºå ±è¡¨åœ–ç‰‡">åŒ¯å‡ºå ±è¡¨ç‚ºåœ–ç‰‡</button>

<script>
  // å‡è³‡æ–™ç¤ºç¯„ï¼ˆæ­£å¼ç”¨ fetch å–ä»£ï¼‰
  const allProducts = [
    { displayName: "å“é …A", price: 120, pv: 10 },
    { displayName: "å“é …B", price: 200, pv: 18 },
    { displayName: "å“é …C", price: 80, pv: 5 },
    { displayName: "å“é …D", price: 150, pv: 12 },
    { displayName: "å“é …E", price: 300, pv: 25 }
  ];

  // ç”Ÿæˆæ•¸é‡é¸é … 1~10
  const qtyInput = document.getElementById("qtyInput");
  for (let i = 1; i <= 10; i++) {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = i;
    qtyInput.appendChild(option);
  }

  const nameInput = document.getElementById("nameInput");
  const autocompleteList = document.getElementById("autocomplete-list");
  const inputArea = document.getElementById("inputArea");
  const addBtn = document.getElementById("addBtn");
  const reportBody = document.getElementById("reportBody");
  const totalQty = document.getElementById("totalQty");
  const totalPrice = document.getElementById("totalPrice");
  const totalPv = document.getElementById("totalPv");

  // å·²é¸æ“‡å“é …æ¸…å–®
  let selectedProducts = [];

  // æ¸²æŸ“è‡ªå‹•å®Œæˆåˆ—è¡¨
  function renderAutocomplete(value) {
    autocompleteList.innerHTML = "";
    if (!value) {
      autocompleteList.style.display = "none";
      inputArea.setAttribute("aria-expanded", "false");
      return;
    }
    const valLower = value.toLowerCase();
    const filtered = allProducts.filter(p => p.displayName.toLowerCase().includes(valLower));
    if (filtered.length === 0) {
      autocompleteList.style.display = "none";
      inputArea.setAttribute("aria-expanded", "false");
      return;
    }
    filtered.forEach(p => {
      const div = document.createElement("div");
      div.textContent = p.displayName;
      div.tabIndex = 0;
      div.setAttribute("role", "option");
      div.addEventListener("click", () => {
        nameInput.value = p.displayName;
        autocompleteList.style.display = "none";
        inputArea.setAttribute("aria-expanded", "false");
        qtyInput.focus();
      });
      div.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          div.click();
        }
      });
      autocompleteList.appendChild(div);
    });
    autocompleteList.style.display = "block";
    inputArea.setAttribute("aria-expanded", "true");
  }

  nameInput.addEventListener("input", (e) => {
    renderAutocomplete(e.target.value);
  });

  nameInput.addEventListener("focus", () => {
    if (nameInput.value) {
      renderAutocomplete(nameInput.value);
    }
  });

  // é»æ“Šå¤–éƒ¨éš±è—ä¸‹æ‹‰
  document.addEventListener("click", (e) => {
    if (!inputArea.contains(e.target)) {
      autocompleteList.style.display = "none";
      inputArea.setAttribute("aria-expanded", "false");
    }
  });

  // æ–°å¢å“é …äº‹ä»¶
  addBtn.addEventListener("click", () => {
    const inputName = nameInput.value.trim();
    if (!inputName) {
      alert("è«‹è¼¸å…¥å“é …åç¨±");
      return;
    }

    // æ‰¾å“é …è³‡æ–™ï¼ˆå¤§å°å¯«ä¸æ•æ„Ÿï¼‰
    const foundProduct = allProducts.find(p => p.displayName.toLowerCase() === inputName.toLowerCase());
    if (!foundProduct) {
      alert("å“é …ä¸å­˜åœ¨ï¼Œè«‹å¾ä¸‹æ‹‰é¸å–®é¸æ“‡æˆ–ç¢ºèªè¼¸å…¥æ­£ç¢º");
      return;
    }

    const qty = parseInt(qtyInput.value, 10);
    if (isNaN(qty) || qty <= 0) {
      alert("æ•¸é‡å¿…é ˆæ˜¯æ­£æ•´æ•¸");
      return;
    }

    // åŒä¸€å“é …åˆä½µæ•¸é‡
    const existIndex = selectedProducts.findIndex(item => item.name.toLowerCase() === foundProduct.displayName.toLowerCase());
    if (existIndex > -1) {
      selectedProducts[existIndex].qty += qty;
    } else {
      selectedProducts.push({
        name: foundProduct.displayName,
        price: foundProduct.price,
        pv: foundProduct.pv,
        qty: qty,
      });
    }

    // æ¸…ç©ºè¼¸å…¥æ¬„ä½
    nameInput.value = "";
    qtyInput.value = 1;
    autocompleteList.style.display = "none";
    inputArea.setAttribute("aria-expanded", "false");

    // é‡æ–°æ¸²æŸ“å ±è¡¨
    renderReport();

    // å°‡ç„¦é»å›åˆ°å“é …è¼¸å…¥æ¡†
    nameInput.focus();
  });

  // æ¸²æŸ“å ±è¡¨
  function renderReport() {
    reportBody.innerHTML = "";
    let sumQty = 0;
    let sumPrice = 0;
    let sumPv = 0;

    selectedProducts.forEach((item, idx) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.textContent = item.name;
      tr.appendChild(tdName);

      const tdQty = document.createElement("td");
      tdQty.textContent = item.qty;
      tr.appendChild(tdQty);

      const tdPrice = document.createElement("td");
      tdPrice.textContent = item.price.toLocaleString();
      tr.appendChild(tdPrice);

      const tdPv = document.createElement("td");
      tdPv.textContent = item.pv.toLocaleString();
      tr.appendChild(tdPv);

      const tdSubtotalPrice = document.createElement("td");
      tdSubtotalPrice.textContent = (item.price * item.qty).toLocaleString();
      tr.appendChild(tdSubtotalPrice);

      const tdSubtotalPv = document.createElement("td");
      tdSubtotalPv.textContent = (item.pv * item.qty).toLocaleString();
      tr.appendChild(tdSubtotalPv);

      const tdDel = document.createElement("td");
      const delBtn = document.createElement("button");
      delBtn.textContent = "åˆªé™¤";
      delBtn.className = "deleteBtn";
      delBtn.setAttribute("aria-label", `åˆªé™¤å“é … ${item.name}`);
      delBtn.addEventListener("click", () => {
        selectedProducts.splice(idx, 1);
        renderReport();
      });
      tdDel.appendChild(delBtn);
      tr.appendChild(tdDel);

      reportBody.appendChild(tr);

      sumQty += item.qty;
      sumPrice += item.price * item.qty;
      sumPv += item.pv * item.qty;
    });

    totalQty.textContent = sumQty.toLocaleString();
    totalPrice.textContent = sumPrice.toLocaleString();
    totalPv.textContent = sumPv.toLocaleString();
  }

  // åŒ¯å‡ºåœ–ç‰‡åŠŸèƒ½
  document.getElementById("exportBtn").addEventListener("click", () => {
    const captureArea = document.getElementById("captureArea");
    html2canvas(captureArea).then(canvas => {
      const link = document.createElement("a");
      link.download = `å“é …å ±è¡¨_${new Date().toISOString().slice(0,10)}.png`;
      link.href = canvas.toDataURL();
      link.click();
    });
  });

</script>

</body>
</html>
